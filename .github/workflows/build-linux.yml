name: build-linux
on:
  push:
    branches:
      - master
  pull_request:
  workflow_dispatch:
  workflow_call:

env:
  QWT_version: 6.3.0

jobs:
  build-linux:
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-24.04, ubuntu-22.04]
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v4
      - run: sudo apt update
      - run: sudo apt install -y apt-utils build-essential wget qt6-base-dev-tools qt6-declarative-dev qt6-multimedia-dev libqt6charts6-dev libqt6datavisualization6-dev libqt6svg6-dev libopencv-core-dev libopencv-dev libqwt-qt5-6 libqwt-qt5-dev libarmadillo-dev libgl1-mesa-dev libglu1-mesa-dev
      - run: wget -O qwt-${{env.QWT_version}}.zip https://sourceforge.net/projects/qwt/files/qwt/${{env.QWT_version}}/qwt-${{env.QWT_version}}.zip/download?use_mirror=pilotfiber
      - run: 7z x qwt-${{env.QWT_version}}.zip
      - run: cd qwt-${{env.QWT_version}} ; /usr/lib/qt6/bin/qmake
      - run: cd qwt-${{env.QWT_version}} ; make -j4
      - run: cd qwt-${{env.QWT_version}} ; sudo make install
      - run: /usr/lib/qt6/bin/qmake
      - uses: ammaraskar/gcc-problem-matcher@master
      - run: echo "::add-matcher::.github/matcher/uic_matcher.json"
      - run: make -j4
      - run: echo "::remove-matcher owner=uic-problem-matcher::"
